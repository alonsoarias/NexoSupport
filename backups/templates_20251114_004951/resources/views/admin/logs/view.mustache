<!-- Log Entry Details -->
<div class="admin-container">
    <div class="admin-header">
        <div>
            <h2>Detalles del Registro</h2>
            <p class="text-muted">ID: {{log.id}}</p>
        </div>
        <div class="admin-user-info">
            <span><i class="bi bi-person-circle"></i> {{current_user.full_name}}</span>
            <a href="/admin/logs" class="btn btn-sm btn-neutral">
                <i class="bi bi-arrow-left"></i> Volver a Registros
            </a>
            <a href="/logout" class="btn btn-sm btn-danger">
                <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
            </a>
        </div>
    </div>

    <!-- Log Details Card -->
    <div class="detail-container">
        <!-- Header Info -->
        <div class="detail-header">
            <div class="header-main">
                <div class="level-badge badge badge-{{log.level}}">{{log.level}}</div>
                <div class="header-info">
                    <h3>{{log.message}}</h3>
                    <p class="text-muted">{{log.created_at_formatted}}</p>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs" role="tablist" style="margin-top: 20px;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">
                    <i class="bi bi-info-circle"></i> Detalles
                </button>
            </li>
            {{#log.context}}
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="context-tab" data-bs-toggle="tab" data-bs-target="#context" type="button" role="tab" aria-controls="context" aria-selected="false">
                    <i class="bi bi-code-square"></i> Contexto
                </button>
            </li>
            {{/log.context}}
            {{#related_logs}}
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="related-tab" data-bs-toggle="tab" data-bs-target="#related" type="button" role="tab" aria-controls="related" aria-selected="false">
                    <i class="bi bi-link-45deg"></i> Registros Relacionados
                </button>
            </li>
            {{/related_logs}}
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Details Tab -->
            <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                <div class="detail-grid">
                    <!-- Left Column -->
                    <div class="detail-column">
                        <div class="detail-item">
                            <label>ID</label>
                            <code>{{log.id}}</code>
                        </div>

                        <div class="detail-item">
                            <label>Nivel</label>
                            <span class="badge badge-{{log.level}}">{{log.level}}</span>
                        </div>

                        <div class="detail-item">
                            <label>Canal</label>
                            <span class="channel-badge">{{log.channel}}</span>
                        </div>

                        <div class="detail-item">
                            <label>Fecha/Hora</label>
                            <p>{{log.created_at_formatted}}</p>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="detail-column">
                        <div class="detail-item">
                            <label>Usuario</label>
                            {{#log.user_full_name}}
                            <p>{{log.user_full_name}}</p>
                            {{/log.user_full_name}}
                            {{^log.user_full_name}}
                            <p class="text-muted">Sistema</p>
                            {{/log.user_full_name}}
                        </div>

                        <div class="detail-item">
                            <label>Dirección IP</label>
                            <code>{{log.ip_address}}</code>
                        </div>

                        <div class="detail-item">
                            <label>User Agent</label>
                            <p class="small text-muted">{{log.user_agent}}</p>
                        </div>
                    </div>
                </div>

                <!-- Message -->
                <div class="detail-item full-width">
                    <label>Mensaje</label>
                    <div class="message-box">
                        {{log.message}}
                    </div>
                </div>
            </div>

            <!-- Context Tab -->
            {{#log.context}}
            <div class="tab-pane fade" id="context" role="tabpanel" aria-labelledby="context-tab">
                <div class="context-container">
                    <pre><code>{{log.context_json}}</code></pre>
                    <button class="btn btn-sm btn-secondary" onclick="copyToClipboard()" style="margin-top: 10px;">
                        <i class="bi bi-clipboard"></i> Copiar
                    </button>
                </div>
            </div>
            {{/log.context}}

            <!-- Related Logs Tab -->
            {{#related_logs}}
            <div class="tab-pane fade" id="related" role="tabpanel" aria-labelledby="related-tab">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fecha/Hora</th>
                                <th>Nivel</th>
                                <th>Mensaje</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#related_logs}}
                            <tr>
                                <td>{{created_at_formatted}}</td>
                                <td>
                                    <span class="badge badge-{{level}}">{{level}}</span>
                                </td>
                                <td>
                                    <small>{{message}}</small>
                                </td>
                                <td>
                                    <a href="/admin/logs/view/{{id}}" class="btn btn-sm btn-info">
                                        <i class="bi bi-arrow-right"></i> Ver
                                    </a>
                                </td>
                            </tr>
                            {{/related_logs}}
                        </tbody>
                    </table>
                </div>
            </div>
            {{/related_logs}}
        </div>
    </div>
</div>

<style>
    .detail-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .detail-header {
        border-bottom: 1px solid #e0e0e0;
        padding-bottom: 20px;
        margin-bottom: 20px;
    }

    .header-main {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .level-badge {
        font-size: 1.1rem;
        padding: 8px 12px;
    }

    .header-info h3 {
        margin: 0 0 5px 0;
        color: #333;
        word-break: break-word;
    }

    .header-info p {
        margin: 0;
        color: #999;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 20px;
    }

    .detail-column {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .detail-item {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
    }

    .detail-item.full-width {
        grid-column: 1 / -1;
    }

    .detail-item label {
        display: block;
        font-weight: 600;
        font-size: 0.85rem;
        color: #666;
        margin-bottom: 8px;
        text-transform: uppercase;
    }

    .detail-item p {
        margin: 0;
        color: #333;
        word-break: break-all;
    }

    .detail-item code {
        background: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid #e0e0e0;
        display: inline-block;
        color: #d63384;
        font-size: 0.9em;
    }

    .channel-badge {
        display: inline-block;
        padding: 5px 10px;
        background: #e7f3ff;
        border-radius: 4px;
        font-size: 0.9rem;
        font-weight: 500;
        color: #004085;
    }

    .message-box {
        background: #fff;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
        line-height: 1.5;
        color: #333;
        word-break: break-word;
        white-space: pre-wrap;
    }

    .context-container {
        background: #f8f9fa;
        border-radius: 6px;
        padding: 15px;
    }

    .context-container pre {
        background: #fff;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        overflow-x: auto;
        margin: 0;
    }

    .context-container code {
        font-family: 'Courier New', monospace;
        color: #333;
        font-size: 0.9rem;
    }

    .badge-error {
        background-color: #dc3545;
        color: white;
    }

    .badge-warning {
        background-color: #ffc107;
        color: #000;
    }

    .badge-info {
        background-color: #0dcaf0;
        color: #000;
    }

    .badge-debug {
        background-color: #6c757d;
        color: white;
    }

    .badge-emergency,
    .badge-alert,
    .badge-critical {
        background-color: #721c24;
        color: white;
    }

    .badge-notice {
        background-color: #004085;
        color: white;
    }

    .nav-tabs .nav-link {
        color: #666;
        border-color: #e0e0e0;
    }

    .nav-tabs .nav-link:hover {
        border-color: #999;
    }

    .nav-tabs .nav-link.active {
        color: #0066cc;
        background-color: #f8f9fa;
        border-color: #0066cc;
        border-bottom-color: #f8f9fa !important;
    }

    .tab-pane {
        padding-top: 20px;
    }

    .table-responsive {
        overflow-x: auto;
    }

    @media (max-width: 768px) {
        .detail-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .header-main {
            flex-direction: column;
            align-items: flex-start;
        }

        .filter-row {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    function copyToClipboard() {
        const context = document.querySelector('.context-container code').textContent;
        navigator.clipboard.writeText(context).then(() => {
            alert('Contexto copiado al portapapeles');
        }).catch(err => {
            console.error('Error al copiar:', err);
        });
    }
</script>
