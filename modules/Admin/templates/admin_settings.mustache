{{#has_sections}}
<div class="subsection-nav">
    <nav class="nav nav-pills">
        {{#sections}}
        <a href="/admin/settings.php?section={{key}}" class="nav-link {{#is_active}}active{{/is_active}}">
            {{name}}
        </a>
        {{/sections}}
    </nav>
</div>
{{/has_sections}}

<div class="settings-section">
    <h3>
        <i class="bi bi-gear"></i> {{section_title}}
    </h3>

    {{#section_description}}
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> {{section_description}}
    </div>
    {{/section_description}}

    <form method="POST" action="/admin/settings.php?section={{current_section}}" enctype="multipart/form-data">
        {{#settings}}
        <div class="mb-4">
            <label for="{{name}}" class="form-label">
                <strong>{{label}}</strong>
            </label>

            {{#type_text}}
            <input type="text" class="form-control" id="{{name}}" name="{{name}}" value="{{value}}">
            {{/type_text}}

            {{#type_email}}
            <input type="email" class="form-control" id="{{name}}" name="{{name}}" value="{{value}}">
            {{/type_email}}

            {{#type_password}}
            <input type="password" class="form-control" id="{{name}}" name="{{name}}" value="{{value}}" placeholder="••••••••">
            <small class="form-text text-muted">Dejar en blanco para mantener valor actual</small>
            {{/type_password}}

            {{#type_number}}
            <input type="number" class="form-control" id="{{name}}" name="{{name}}" value="{{value}}">
            {{/type_number}}

            {{#type_textarea}}
            <textarea class="form-control" id="{{name}}" name="{{name}}" rows="{{rows}}">{{value}}</textarea>
            {{/type_textarea}}

            {{#type_checkbox}}
            <div class="form-check form-switch">
                <input type="checkbox" class="form-check-input" id="{{name}}" name="{{name}}" value="1" {{#value}}checked{{/value}}>
                <label class="form-check-label" for="{{name}}">Habilitado</label>
            </div>
            {{/type_checkbox}}

            {{#type_select}}
            <select class="form-select" id="{{name}}" name="{{name}}">
                {{#options}}
                <option value="{{key}}" {{#is_selected}}selected{{/is_selected}}>{{label}}</option>
                {{/options}}
            </select>
            {{/type_select}}

            {{#type_color}}
            <div class="input-group">
                <input type="color" class="form-control form-control-color" id="{{name}}" name="{{name}}" value="{{value}}">
                <input type="text" class="form-control" value="{{value}}" readonly>
            </div>
            {{/type_color}}

            {{#type_file}}
            <input type="file" class="form-control" id="{{name}}" name="{{name}}">
            {{#value}}
            <small class="form-text text-muted">Archivo actual: {{value}}</small>
            {{/value}}
            {{/type_file}}

            {{#description}}
            <div class="form-text">{{description}}</div>
            {{/description}}
        </div>
        {{/settings}}

        <hr>

        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Guardar Cambios
            </button>
            <a href="/admin/settings.php" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i> Cancelar
            </a>
        </div>
    </form>
</div>

{{#show_test_email}}
<div class="settings-section mt-4">
    <h4><i class="bi bi-envelope-check"></i> Probar Configuración de Email</h4>
    <form method="POST" action="/admin/settings.php?section={{current_section}}&action=test_email">
        <div class="mb-3">
            <label for="test_email_address" class="form-label">Dirección de Prueba</label>
            <input type="email" class="form-control" id="test_email_address" name="test_email_address" required>
        </div>
        <button type="submit" class="btn btn-success">
            <i class="bi bi-send"></i> Enviar Email de Prueba
        </button>
    </form>
</div>
{{/show_test_email}}
