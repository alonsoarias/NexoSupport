<!-- System Settings -->
<div class="settings-container">
    <div class="page-header">
        <div>
            <h2>{{#__}}settings.title{{/__}}</h2>
            <p class="text-muted">{{#__}}settings.description{{/__}}</p>
        </div>
    </div>

    {{#success_message}}
    <div class="alert alert-success">
        <i class="bi bi-check-circle"></i>
        {{success_message}}
    </div>
    {{/success_message}}

    {{#error_message}}
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle"></i>
        {{error_message}}
    </div>
    {{/error_message}}

    <!-- Tabbed Interface -->
    <div class="tabs-container">
        <!-- Tab Navigation -->
        <ul class="nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-tab="general" role="tab">
                    <i class="bi bi-gear"></i>
                    {{#__}}settings.tabs.general{{/__}}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-tab="email" role="tab">
                    <i class="bi bi-envelope"></i>
                    {{#__}}settings.tabs.email{{/__}}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-tab="security" role="tab">
                    <i class="bi bi-shield-check"></i>
                    {{#__}}settings.tabs.security{{/__}}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-tab="appearance" role="tab">
                    <i class="bi bi-palette"></i>
                    {{#__}}settings.tabs.appearance{{/__}}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-tab="advanced" role="tab">
                    <i class="bi bi-sliders"></i>
                    {{#__}}settings.tabs.advanced{{/__}}
                </a>
            </li>
        </ul>

        <!-- Settings Form -->
        <form id="settings-form" method="POST" action="/admin/settings">
            <div class="tab-content">

                <!-- General Settings Tab -->
                <div class="tab-pane active" id="general-tab" role="tabpanel">
                    <div class="settings-section">
                        <h3>{{#__}}settings.groups.general{{/__}}</h3>

                        <div class="form-group">
                            <label for="site_name">{{#__}}settings.fields.site_name{{/__}}</label>
                            <input type="text"
                                   id="site_name"
                                   name="site_name"
                                   class="form-control"
                                   value="{{general_settings.site_name}}"
                                   required>
                            <small class="form-text">{{#__}}settings.help.site_name{{/__}}</small>
                        </div>

                        <div class="form-group">
                            <label for="site_description">{{#__}}settings.fields.site_description{{/__}}</label>
                            <textarea id="site_description"
                                      name="site_description"
                                      class="form-control"
                                      rows="3">{{general_settings.site_description}}</textarea>
                            <small class="form-text">{{#__}}settings.help.site_description{{/__}}</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="timezone">{{#__}}settings.fields.timezone{{/__}}</label>
                                <select id="timezone" name="timezone" class="form-control">
                                    {{#timezones}}
                                    <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                    {{/timezones}}
                                </select>
                                <small class="form-text">{{#__}}settings.help.timezone{{/__}}</small>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="locale">{{#__}}settings.fields.locale{{/__}}</label>
                                <select id="locale" name="locale" class="form-control">
                                    {{#locales}}
                                    <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                    {{/locales}}
                                </select>
                                <small class="form-text">{{#__}}settings.help.locale{{/__}}</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="date_format">{{#__}}settings.fields.date_format{{/__}}</label>
                            <select id="date_format" name="date_format" class="form-control">
                                {{#date_formats}}
                                <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                {{/date_formats}}
                            </select>
                            <small class="form-text">{{#__}}settings.help.date_format{{/__}}</small>
                        </div>
                    </div>
                </div>

                <!-- Email Settings Tab -->
                <div class="tab-pane" id="email-tab" role="tabpanel">
                    <div class="settings-section">
                        <h3>{{#__}}settings.groups.email{{/__}}</h3>

                        <div class="form-group">
                            <label for="from_name">{{#__}}settings.fields.from_name{{/__}}</label>
                            <input type="text"
                                   id="from_name"
                                   name="from_name"
                                   class="form-control"
                                   value="{{email_settings.from_name}}"
                                   required>
                            <small class="form-text">{{#__}}settings.help.from_name{{/__}}</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="from_address">{{#__}}settings.fields.from_address{{/__}}</label>
                                <input type="email"
                                       id="from_address"
                                       name="from_address"
                                       class="form-control"
                                       value="{{email_settings.from_address}}"
                                       required>
                                <small class="form-text">{{#__}}settings.help.from_address{{/__}}</small>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="reply_to">{{#__}}settings.fields.reply_to{{/__}}</label>
                                <input type="email"
                                       id="reply_to"
                                       name="reply_to"
                                       class="form-control"
                                       value="{{email_settings.reply_to}}"
                                       required>
                                <small class="form-text">{{#__}}settings.help.reply_to{{/__}}</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="mail_driver">{{#__}}settings.fields.mail_driver{{/__}}</label>
                            <select id="mail_driver" name="mail_driver" class="form-control">
                                {{#mail_drivers}}
                                <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                {{/mail_drivers}}
                            </select>
                            <small class="form-text">{{#__}}settings.help.mail_driver{{/__}}</small>
                        </div>
                    </div>
                </div>

                <!-- Security Settings Tab -->
                <div class="tab-pane" id="security-tab" role="tabpanel">
                    <div class="settings-section">
                        <h3>{{#__}}settings.groups.security{{/__}}</h3>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="session_lifetime">{{#__}}settings.fields.session_lifetime{{/__}}</label>
                                <input type="number"
                                       id="session_lifetime"
                                       name="session_lifetime"
                                       class="form-control"
                                       value="{{security_settings.session_lifetime}}"
                                       min="5"
                                       max="1440"
                                       required>
                                <small class="form-text">{{#__}}settings.help.session_lifetime{{/__}}</small>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="password_min_length">{{#__}}settings.fields.password_min_length{{/__}}</label>
                                <input type="number"
                                       id="password_min_length"
                                       name="password_min_length"
                                       class="form-control"
                                       value="{{security_settings.password_min_length}}"
                                       min="6"
                                       max="32"
                                       required>
                                <small class="form-text">{{#__}}settings.help.password_min_length{{/__}}</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-wrapper">
                                <input type="checkbox"
                                       id="require_email_verification"
                                       name="require_email_verification"
                                       {{#security_settings.require_email_verification}}checked{{/security_settings.require_email_verification}}>
                                <label for="require_email_verification">{{#__}}settings.fields.require_email_verification{{/__}}</label>
                            </div>
                            <small class="form-text">{{#__}}settings.help.require_email_verification{{/__}}</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="login_max_attempts">{{#__}}settings.fields.login_max_attempts{{/__}}</label>
                                <input type="number"
                                       id="login_max_attempts"
                                       name="login_max_attempts"
                                       class="form-control"
                                       value="{{security_settings.login_max_attempts}}"
                                       min="3"
                                       max="20"
                                       required>
                                <small class="form-text">{{#__}}settings.help.login_max_attempts{{/__}}</small>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="lockout_duration">{{#__}}settings.fields.lockout_duration{{/__}}</label>
                                <input type="number"
                                       id="lockout_duration"
                                       name="lockout_duration"
                                       class="form-control"
                                       value="{{security_settings.lockout_duration}}"
                                       min="1"
                                       max="1440"
                                       required>
                                <small class="form-text">{{#__}}settings.help.lockout_duration{{/__}}</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Appearance Settings Tab -->
                <div class="tab-pane" id="appearance-tab" role="tabpanel">
                    <div class="settings-section">
                        <h3>{{#__}}settings.groups.appearance{{/__}}</h3>

                        <div class="form-group">
                            <label for="theme">{{#__}}settings.fields.theme{{/__}}</label>
                            <select id="theme" name="theme" class="form-control">
                                {{#themes}}
                                <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                {{/themes}}
                            </select>
                            <small class="form-text">{{#__}}settings.help.theme{{/__}}</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="items_per_page">{{#__}}settings.fields.items_per_page{{/__}}</label>
                                <input type="number"
                                       id="items_per_page"
                                       name="items_per_page"
                                       class="form-control"
                                       value="{{appearance_settings.items_per_page}}"
                                       min="10"
                                       max="100"
                                       required>
                                <small class="form-text">{{#__}}settings.help.items_per_page{{/__}}</small>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="default_language">{{#__}}settings.fields.default_language{{/__}}</label>
                                <select id="default_language" name="default_language" class="form-control">
                                    {{#locales}}
                                    <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                    {{/locales}}
                                </select>
                                <small class="form-text">{{#__}}settings.help.default_language{{/__}}</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Settings Tab -->
                <div class="tab-pane" id="advanced-tab" role="tabpanel">
                    <div class="settings-section">
                        <h3>{{#__}}settings.groups.advanced{{/__}}</h3>

                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            {{#__}}settings.warnings.advanced{{/__}}
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="cache_driver">{{#__}}settings.fields.cache_driver{{/__}}</label>
                                <select id="cache_driver" name="cache_driver" class="form-control">
                                    {{#cache_drivers}}
                                    <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                    {{/cache_drivers}}
                                </select>
                                <small class="form-text">{{#__}}settings.help.cache_driver{{/__}}</small>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="log_level">{{#__}}settings.fields.log_level{{/__}}</label>
                                <select id="log_level" name="log_level" class="form-control">
                                    {{#log_levels}}
                                    <option value="{{value}}" {{#selected}}selected{{/selected}}>{{label}}</option>
                                    {{/log_levels}}
                                </select>
                                <small class="form-text">{{#__}}settings.help.log_level{{/__}}</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-wrapper sensitive">
                                <input type="checkbox"
                                       id="debug_mode"
                                       name="debug_mode"
                                       {{#advanced_settings.debug_mode}}checked{{/advanced_settings.debug_mode}}>
                                <label for="debug_mode">
                                    {{#__}}settings.fields.debug_mode{{/__}}
                                    <span class="badge badge-warning">{{#__}}settings.badges.sensitive{{/__}}</span>
                                </label>
                            </div>
                            <small class="form-text text-warning">{{#__}}settings.help.debug_mode{{/__}}</small>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-wrapper sensitive">
                                <input type="checkbox"
                                       id="maintenance_mode"
                                       name="maintenance_mode"
                                       {{#advanced_settings.maintenance_mode}}checked{{/advanced_settings.maintenance_mode}}>
                                <label for="maintenance_mode">
                                    {{#__}}settings.fields.maintenance_mode{{/__}}
                                    <span class="badge badge-danger">{{#__}}settings.badges.critical{{/__}}</span>
                                </label>
                            </div>
                            <small class="form-text text-danger">{{#__}}settings.help.maintenance_mode{{/__}}</small>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-save"></i>
                    {{#__}}settings.actions.save{{/__}}
                </button>

                <button type="button" class="btn btn-secondary btn-lg" onclick="window.location.href='/admin'">
                    <i class="bi bi-x-circle"></i>
                    {{#__}}settings.actions.cancel{{/__}}
                </button>

                <button type="button" class="btn btn-warning btn-lg" onclick="resetSettings()">
                    <i class="bi bi-arrow-counterclockwise"></i>
                    {{#__}}settings.actions.reset{{/__}}
                </button>
            </div>
        </form>
    </div>
</div>

<style>
/* Settings Container */
.settings-container {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

/* Page Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
}

.page-header h2 {
    color: var(--text-primary);
    margin: 0 0 5px 0;
    font-size: 1.8rem;
}

.text-muted {
    color: var(--text-secondary);
    margin: 0;
    font-size: 0.95rem;
}

/* Alerts */
.alert {
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border-left: 4px solid #28a745;
}

.alert-danger {
    background: #f8d7da;
    color: #721c24;
    border-left: 4px solid #dc3545;
}

.alert-warning {
    background: #fff3cd;
    color: #856404;
    border-left: 4px solid #ffc107;
}

.alert i {
    font-size: 1.5rem;
}

/* Tabs Container */
.tabs-container {
    background: var(--bg-secondary);
    border-radius: 12px;
    overflow: hidden;
}

/* Tab Navigation */
.nav-tabs {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    background: var(--bg-primary);
    border-bottom: 2px solid var(--border-color);
    overflow-x: auto;
}

.nav-item {
    flex: 1;
    min-width: 150px;
}

.nav-link {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 15px 20px;
    color: var(--text-secondary);
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 3px solid transparent;
    font-weight: 500;
}

.nav-link:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.nav-link.active {
    color: var(--iser-green);
    border-bottom-color: var(--iser-green);
    background: var(--bg-secondary);
}

.nav-link i {
    font-size: 1.2rem;
}

/* Tab Content */
.tab-content {
    padding: 30px;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Settings Section */
.settings-section {
    max-width: 900px;
}

.settings-section h3 {
    color: var(--text-primary);
    margin: 0 0 25px 0;
    font-size: 1.3rem;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

/* Form Elements */
.form-group {
    margin-bottom: 25px;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.95rem;
}

.form-control {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    font-size: 1rem;
    color: var(--text-primary);
    background: var(--bg-primary);
    transition: all 0.2s;
}

.form-control:focus {
    outline: none;
    border-color: var(--iser-green);
    box-shadow: 0 0 0 3px rgba(27, 158, 136, 0.1);
}

textarea.form-control {
    resize: vertical;
    min-height: 80px;
}

.form-text {
    display: block;
    margin-top: 5px;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.form-text.text-warning {
    color: #856404;
}

.form-text.text-danger {
    color: #721c24;
}

/* Checkboxes */
.checkbox-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background: var(--bg-primary);
    border-radius: 6px;
    border: 1px solid var(--border-color);
}

.checkbox-wrapper.sensitive {
    border-left: 4px solid #ffc107;
}

.checkbox-wrapper input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.checkbox-wrapper label {
    margin: 0;
    cursor: pointer;
    flex: 1;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Badges */
.badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    color: white;
}

.badge-warning {
    background: #ffc107;
    color: #000;
}

.badge-danger {
    background: #dc3545;
}

/* Buttons */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    font-size: 1rem;
}

.btn-lg {
    padding: 14px 28px;
    font-size: 1.05rem;
}

.btn-primary {
    background: var(--iser-green);
    color: white;
}

.btn-primary:hover {
    background: #158f77;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(27, 158, 136, 0.3);
}

.btn-secondary {
    background: var(--bg-primary);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.btn-secondary:hover {
    background: var(--border-color);
}

.btn-warning {
    background: #ffc107;
    color: #000;
}

.btn-warning:hover {
    background: #e0a800;
}

/* Form Actions */
.form-actions {
    display: flex;
    gap: 15px;
    padding: 25px 30px;
    background: var(--bg-primary);
    border-top: 2px solid var(--border-color);
    border-radius: 0 0 12px 12px;
    margin: 0 -30px -30px -30px;
}

/* Responsive */
@media (max-width: 768px) {
    .settings-container {
        padding: 10px;
    }

    .nav-tabs {
        flex-direction: column;
    }

    .nav-item {
        width: 100%;
    }

    .tab-content {
        padding: 20px 15px;
    }

    .form-row {
        grid-template-columns: 1fr;
    }

    .form-actions {
        flex-direction: column;
    }

    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
// Tab switching
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();

        // Remove active class from all tabs and links
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));

        // Add active class to clicked tab
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab') + '-tab';
        document.getElementById(tabId).classList.add('active');
    });
});

// Reset settings confirmation
function resetSettings() {
    if (!confirm('{{#__}}settings.confirmations.reset{{/__}}')) {
        return;
    }

    fetch('/admin/settings/reset', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.reload();
        } else {
            alert(data.error || 'Error resetting settings');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error resetting settings');
    });
}

// Form validation
document.getElementById('settings-form').addEventListener('submit', function(e) {
    const debugMode = document.getElementById('debug_mode').checked;
    const maintenanceMode = document.getElementById('maintenance_mode').checked;

    if (debugMode || maintenanceMode) {
        const warnings = [];
        if (debugMode) warnings.push('Debug Mode');
        if (maintenanceMode) warnings.push('Maintenance Mode');

        if (!confirm('{{#__}}settings.confirmations.sensitive{{/__}}\n\n' + warnings.join(', '))) {
            e.preventDefault();
            return false;
        }
    }
});

// Auto-save indicator (optional enhancement)
let formChanged = false;
document.getElementById('settings-form').addEventListener('change', function() {
    formChanged = true;
});

window.addEventListener('beforeunload', function(e) {
    if (formChanged) {
        e.preventDefault();
        e.returnValue = '';
    }
});

document.getElementById('settings-form').addEventListener('submit', function() {
    formChanged = false;
});
</script>
