<!-- Audit Log Detail View -->
<div class="admin-container audit-detail">
    <div class="admin-header">
        <div>
            <h2>{{trans.details}}</h2>
            <p class="text-muted">Complete audit entry details</p>
        </div>
        <div class="header-actions">
            <a href="/admin/audit" class="btn btn-sm btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to Logs
            </a>
        </div>
    </div>

    <!-- Success/Error Messages -->
    {{#success}}
    <div class="alert alert-success">
        <i class="bi bi-check-circle"></i>
        {{success}}
    </div>
    {{/success}}

    {{#error}}
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-circle"></i>
        {{error}}
    </div>
    {{/error}}

    <!-- Main Details Card -->
    <div class="details-card">
        <div class="card-header">
            <h3>{{trans.description}}</h3>
        </div>

        <div class="details-grid">
            <div class="detail-row">
                <div class="detail-label">{{trans.id}}</div>
                <div class="detail-value">
                    <code>#{{audit_log.id}}</code>
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">{{trans.timestamp}}</div>
                <div class="detail-value">
                    {{audit_log.timestamp_formatted}}
                    <small class="text-muted">({{audit_log.timestamp}} seconds)</small>
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">{{trans.user}}</div>
                <div class="detail-value">
                    {{#audit_log.user_id}}
                    <div class="user-info">
                        <i class="bi bi-person-circle"></i>
                        <div>
                            <strong>{{audit_log.username}}</strong>
                            <small class="text-muted">{{audit_log.email}}</small>
                        </div>
                    </div>
                    {{/audit_log.user_id}}
                    {{^audit_log.user_id}}
                    <span class="badge badge-secondary">System</span>
                    {{/audit_log.user_id}}
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">{{trans.event}}</div>
                <div class="detail-value">
                    <span class="badge {{audit_log.action_class}}">{{audit_log.action_label}}</span>
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">{{trans.entity_type}}</div>
                <div class="detail-value">
                    <strong>{{audit_log.entity_label}}</strong>
                    {{#audit_log.entity_id}}
                    <small class="text-muted">(ID: {{audit_log.entity_id}})</small>
                    {{/audit_log.entity_id}}
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">{{trans.ip_address}}</div>
                <div class="detail-value">
                    <code>{{audit_log.ip_address}}</code>
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">{{trans.user_agent}}</div>
                <div class="detail-value">
                    <small class="text-muted" title="{{audit_log.user_agent}}">{{audit_log.user_agent}}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Changes Section -->
    {{#audit_log.has_changes}}
    <div class="details-card">
        <div class="card-header">
            <h3>{{trans.changes}}</h3>
        </div>

        {{#audit_log.changes}}
        <div class="change-item">
            <div class="change-field">
                <strong>{{field}}</strong>
            </div>
            <div class="change-values">
                <div class="change-row">
                    <div class="change-label">{{trans.change_details.old_value}}</div>
                    <div class="change-value-old">
                        <code class="value-code">{{old_value}}</code>
                    </div>
                </div>
                <div class="change-arrow">
                    <i class="bi bi-arrow-right"></i>
                </div>
                <div class="change-row">
                    <div class="change-label">{{trans.change_details.new_value}}</div>
                    <div class="change-value-new">
                        <code class="value-code">{{new_value}}</code>
                    </div>
                </div>
            </div>
        </div>
        {{/audit_log.changes}}
    </div>

    <!-- JSON View (Optional) -->
    <div class="details-card">
        <div class="card-header">
            <h3>Raw JSON Data</h3>
        </div>

        <div class="json-container">
            <div class="json-section">
                <h4>{{trans.old_values}}</h4>
                <pre><code>{{audit_log.old_values}}</code></pre>
            </div>
            <div class="json-section">
                <h4>{{trans.new_values}}</h4>
                <pre><code>{{audit_log.new_values}}</code></pre>
            </div>
        </div>
    </div>
    {{/audit_log.has_changes}}

    {{^audit_log.has_changes}}
    <div class="details-card">
        <div class="card-header">
            <h3>{{trans.changes}}</h3>
        </div>
        <div class="no-changes">
            <i class="bi bi-check-circle"></i>
            <p>{{trans.change_details.no_changes}}</p>
        </div>
    </div>
    {{/audit_log.has_changes}}

    <!-- Related Entity (if exists) -->
    {{#related_entity}}
    <div class="details-card">
        <div class="card-header">
            <h3>Related Entity</h3>
        </div>
        <div class="entity-info">
            <p>
                <strong>Entity Type:</strong> {{related_entity_type}}<br>
                <strong>Details:</strong> <pre><code>{{related_entity_json}}</code></pre>
            </p>
        </div>
    </div>
    {{/related_entity}}
</div>

<style>
.admin-container {
    padding: 20px;
    max-width: 1000px;
    margin: 0 auto;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.admin-header h2 {
    margin: 0;
    font-size: 28px;
}

.admin-header .text-muted {
    margin: 5px 0 0 0;
    color: #666;
}

.header-actions {
    display: flex;
    gap: 10px;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    transition: all 0.3s;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 13px;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background-color: #5a6268;
}

.alert {
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 4px;
    display: flex;
    gap: 10px;
}

.alert-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-danger {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.details-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.card-header {
    padding-bottom: 15px;
    margin-bottom: 20px;
    border-bottom: 2px solid #eee;
}

.card-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.detail-row {
    display: flex;
    flex-direction: column;
}

.detail-label {
    font-weight: 600;
    font-size: 13px;
    color: #666;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.detail-value {
    font-size: 14px;
    color: #333;
}

code {
    background-color: #f4f4f4;
    padding: 4px 8px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 12px;
}

.badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
}

.badge-success {
    background-color: #d4edda;
    color: #155724;
}

.badge-info {
    background-color: #d1ecf1;
    color: #0c5460;
}

.badge-danger {
    background-color: #f8d7da;
    color: #721c24;
}

.badge-secondary {
    background-color: #e2e3e5;
    color: #383d41;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-info i {
    font-size: 24px;
    color: #1B9E88;
}

.user-info strong {
    display: block;
}

.user-info small {
    display: block;
    font-size: 12px;
}

.text-muted {
    color: #6c757d;
}

/* Changes Section */
.change-item {
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 4px;
    margin-bottom: 15px;
    border-left: 4px solid #1B9E88;
}

.change-field {
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid #e0e0e0;
}

.change-field strong {
    font-size: 14px;
    color: #333;
}

.change-values {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 15px;
    align-items: start;
}

.change-row {
    flex: 1;
}

.change-label {
    font-size: 12px;
    font-weight: 600;
    color: #666;
    text-transform: uppercase;
    margin-bottom: 8px;
}

.change-value-old {
    background-color: #ffe6e6;
    padding: 10px;
    border-radius: 4px;
    border-left: 3px solid #dc3545;
}

.change-value-new {
    background-color: #e6ffe6;
    padding: 10px;
    border-radius: 4px;
    border-left: 3px solid #28a745;
}

.value-code {
    display: block;
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 300px;
    overflow-y: auto;
}

.change-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: #1B9E88;
}

.no-changes {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.no-changes i {
    font-size: 48px;
    color: #1B9E88;
    display: block;
    margin-bottom: 15px;
}

.no-changes p {
    font-size: 16px;
}

/* JSON View */
.json-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.json-section {
    flex: 1;
}

.json-section h4 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 14px;
    font-weight: 600;
    color: #333;
}

.json-section pre {
    background-color: #f4f4f4;
    padding: 15px;
    border-radius: 4px;
    overflow-x: auto;
    margin: 0;
    max-height: 400px;
    overflow-y: auto;
}

.json-section code {
    font-size: 12px;
    color: #333;
}

.entity-info {
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 4px;
}

.entity-info pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    margin: 10px 0 0 0;
}

.entity-info code {
    font-size: 12px;
}

@media (max-width: 768px) {
    .details-grid {
        grid-template-columns: 1fr;
    }

    .change-values {
        grid-template-columns: 1fr;
    }

    .change-arrow {
        transform: rotate(90deg);
    }

    .json-container {
        grid-template-columns: 1fr;
    }
}
</style>
