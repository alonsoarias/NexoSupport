{{!
    Upgrade Template - Admin

    Context:
    * upgrade_executed - Boolean if upgrade was executed
    * success - Boolean if upgrade succeeded
    * has_log - Boolean if log exists
    * log - Array of log messages
    * has_errors - Boolean if errors exist
    * errors - Array of error messages
    * needs_upgrade - Boolean if upgrade is needed
    * requirements_ok - Boolean if requirements are met
    * requirement_issues - Array of requirement issues
    * db_version - Database version
    * code_version - Code version
    * release - Release version string
    * version_diff - Version difference
    * has_upgrades - Boolean if upgrades to execute exist
    * upgrades_to_execute - Array of upgrades
    * sesskey - Session key
}}
<style>
        .upgrade-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .upgrade-info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .upgrade-info-box h3 {
            margin-top: 0;
            color: #333;
        }

        .version-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .version-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .version-table td:first-child {
            font-weight: bold;
            width: 200px;
        }

        .upgrade-list {
            list-style: none;
            padding: 0;
        }

        .upgrade-list li {
            padding: 10px;
            margin: 5px 0;
            background: #e9ecef;
            border-radius: 4px;
        }

        .upgrade-list li i {
            color: #667eea;
            margin-right: 10px;
        }

        .requirements-list {
            list-style: none;
            padding: 0;
        }

        .requirements-list li {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .requirements-list .status {
            font-weight: bold;
        }

        .requirements-list .status.ok {
            color: #28a745;
        }

        .requirements-list .status.error {
            color: #dc3545;
        }

        .log-output {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .log-output div {
            margin: 3px 0;
        }

        .upgrade-actions {
            margin: 30px 0;
            text-align: center;
        }

        .btn-upgrade {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-upgrade:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-upgrade:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .alert h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }
    </style>

<div class="upgrade-container">
    <h1><i class="fas fa-sync-alt"></i> {{#str}}upgrade_title,admin{{/str}}</h1>

    {{#upgrade_executed}}
        {{! Resultado del Upgrade }}
        {{#success}}
            <div class="alert alert-success">
                <h4><i class="fas fa-check-circle"></i> {{#str}}upgrade_success,admin{{/str}}</h4>
                <p>{{#str}}upgrade_success,admin{{/str}}: {{release}} ({{code_version}}).</p>
            </div>

            {{#has_log}}
                <h3>{{#str}}upgrade_log,admin{{/str}}:</h3>
                <div class="log-output">
                    {{#log}}
                        <div>{{{.}}}</div>
                    {{/log}}
                </div>
            {{/has_log}}

            <div class="upgrade-actions">
                <a href="/" class="btn-primary">
                    <i class="fas fa-home"></i> {{#str}}back_to_admin,admin{{/str}}
                </a>
            </div>
        {{/success}}

        {{^success}}
            {{! Error en el Upgrade }}
            <div class="alert alert-danger">
                <h4><i class="fas fa-exclamation-triangle"></i> {{#str}}upgrade_error,admin{{/str}}</h4>
                <p>{{#str}}error_occurred,admin{{/str}}.</p>
            </div>

            {{#has_errors}}
                <h3>{{#str}}error_occurred,admin{{/str}}:</h3>
                <div class="alert alert-danger">
                    <ul style="margin: 0; padding-left: 20px;">
                        {{#errors}}
                            <li>{{{.}}}</li>
                        {{/errors}}
                    </ul>
                </div>
            {{/has_errors}}

            {{#has_log}}
                <h3>{{#str}}upgrade_log,admin{{/str}}:</h3>
                <div class="log-output">
                    {{#log}}
                        <div>{{{.}}}</div>
                    {{/log}}
                </div>
            {{/has_log}}

            <div class="upgrade-actions">
                <a href="/admin/upgrade.php" class="btn-primary">
                    <i class="fas fa-redo"></i> {{#str}}continue,admin{{/str}}
                </a>
            </div>
        {{/success}}
    {{/upgrade_executed}}

    {{^upgrade_executed}}
        {{! Información del Upgrade }}

        {{#needs_upgrade}}
            <div class="alert alert-warning">
                <h4><i class="fas fa-exclamation-circle"></i> {{#str}}upgrade_required,admin{{/str}}</h4>
                <p>{{#str}}upgrade_description,admin{{/str}}.</p>
            </div>

            <div class="upgrade-info-box">
                <h3>{{#str}}upgrade_info,admin{{/str}}</h3>
                <table class="version-table">
                    <tr>
                        <td>{{#str}}database_version,admin{{/str}}:</td>
                        <td>{{db_version}}</td>
                    </tr>
                    <tr>
                        <td>{{#str}}code_version,admin{{/str}}:</td>
                        <td><strong>{{code_version}} ({{release}})</strong></td>
                    </tr>
                    <tr>
                        <td>{{#str}}target_version,admin{{/str}}:</td>
                        <td>{{version_diff}}</td>
                    </tr>
                </table>
            </div>

            {{#has_upgrades}}
                <div class="upgrade-info-box">
                    <h3>{{#str}}upgrade_description,admin{{/str}}</h3>
                    <ul class="upgrade-list">
                        {{#upgrades_to_execute}}
                            <li>
                                <i class="fas fa-arrow-right"></i>
                                {{#str}}target_version,admin{{/str}} {{version}}
                            </li>
                        {{/upgrades_to_execute}}
                    </ul>
                </div>
            {{/has_upgrades}}

            {{! Verificación de Requisitos }}
            {{^requirements_ok}}
                <div class="alert alert-danger">
                    <h4><i class="fas fa-exclamation-triangle"></i> {{#str}}upgrade_requirements_failed,admin{{/str}}</h4>
                    <p>{{#str}}upgrade_requirements_failed,admin{{/str}}:</p>
                </div>

                <ul class="requirements-list">
                    {{#requirement_issues}}
                        <li>
                            <span>{{{.}}}</span>
                            <span class="status error"><i class="fas fa-times-circle"></i> {{#str}}error_occurred,admin{{/str}}</span>
                        </li>
                    {{/requirement_issues}}
                </ul>

                <div class="alert alert-info">
                    <p>{{#str}}upgrade_requirements_failed,admin{{/str}}.</p>
                </div>
            {{/requirements_ok}}

            {{#requirements_ok}}
                {{! Todo OK, permitir upgrade }}
                <div class="alert alert-success">
                    <h4><i class="fas fa-check-circle"></i> {{#str}}upgrade_requirements_ok,admin{{/str}}</h4>
                    <p>{{#str}}upgrade_requirements_ok,admin{{/str}}.</p>
                </div>

                <div class="alert alert-info">
                    <h4><i class="fas fa-info-circle"></i> {{#str}}upgrade_warning,admin{{/str}}</h4>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>{{#str}}upgrade_warning,admin{{/str}}</li>
                    </ul>
                </div>

                <form method="POST" action="/admin/upgrade.php" id="upgrade-form">
                    <input type="hidden" name="upgrade" value="true">
                    <input type="hidden" name="sesskey" value="{{sesskey}}">

                    <div class="upgrade-actions">
                        <button type="submit" class="btn-upgrade">
                            <i class="fas fa-rocket"></i> {{#str}}upgrade_button,admin{{/str}}
                        </button>
                    </div>
                </form>
            {{/requirements_ok}}

        {{/needs_upgrade}}

        {{^needs_upgrade}}
            {{! Sistema actualizado }}
            <div class="alert alert-success">
                <h4><i class="fas fa-check-circle"></i> {{#str}}upgrade_not_required,admin{{/str}}</h4>
                <p>{{#str}}upgrade_not_required,admin{{/str}}.</p>
            </div>

            <div class="upgrade-info-box">
                <h3>{{#str}}upgrade_info,admin{{/str}}</h3>
                <table class="version-table">
                    <tr>
                        <td>{{#str}}current_version,admin{{/str}}:</td>
                        <td><strong>{{code_version}} ({{release}})</strong></td>
                    </tr>
                </table>
            </div>

            <div class="upgrade-actions">
                <a href="/" class="btn-primary">
                    <i class="fas fa-home"></i> {{#str}}back_to_admin,admin{{/str}}
                </a>
            </div>
        {{/needs_upgrade}}

    {{/upgrade_executed}}
</div>
