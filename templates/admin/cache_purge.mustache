{{!
    Cache Purge Template

    Context:
    * success - Success message
    * haserrors - Boolean for errors
    * errors - Array of errors
    * has_purge_results - Boolean for purge results
    * purge_results - Purge results object
    * opcache_enabled - Boolean for OPcache
    * opcache_memory_used - OPcache memory used
    * opcache_memory_free - OPcache memory free
    * opcache_memory_wasted - OPcache memory wasted
    * opcache_scripts - OPcache scripts count
    * opcache_hits - OPcache hits
    * opcache_misses - OPcache misses
    * opcache_hit_rate - OPcache hit rate
    * mustache_enabled - Boolean for Mustache cache
    * mustache_templates - Mustache templates count
    * mustache_cache_size - Mustache cache size
    * sesskey - Session key
}}
{{> core/header}}

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 0;
    }

    .alert {
        padding: 1rem 1.25rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .alert-success {
        background: rgba(16, 185, 129, 0.1);
        border-left: 4px solid var(--success);
        color: var(--success);
    }

    .alert-danger {
        background: rgba(239, 68, 68, 0.1);
        border-left: 4px solid var(--error);
        color: var(--error);
    }

    .alert-info {
        background: rgba(59, 130, 246, 0.1);
        border-left: 4px solid var(--info);
        color: #1e40af;
    }

    .alert-icon {
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .cache-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .cache-card {
        background: var(--bg-primary);
        border-radius: 0.75rem;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
    }

    .cache-card-header {
        background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
        color: white;
        padding: 1rem 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .cache-card-body {
        padding: 1.25rem;
    }

    .stats-table {
        width: 100%;
        border-collapse: collapse;
    }

    .stats-table tr {
        border-bottom: 1px solid var(--border-color);
    }

    .stats-table tr:last-child {
        border-bottom: none;
    }

    .stats-table th,
    .stats-table td {
        padding: 0.75rem 0.5rem;
        text-align: left;
    }

    .stats-table th {
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.875rem;
        width: 50%;
    }

    .stats-table td {
        color: var(--text-primary);
        font-weight: 500;
    }

    .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .badge-success {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
    }

    .badge-warning {
        background: rgba(245, 158, 11, 0.15);
        color: #b45309;
    }

    .badge-danger {
        background: rgba(239, 68, 68, 0.15);
        color: var(--error);
    }

    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
        color: white;
        text-decoration: none;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all var(--transition-fast);
        width: 100%;
        margin-bottom: 0.75rem;
    }

    .btn:last-child {
        margin-bottom: 0;
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .btn-danger {
        background: var(--error);
    }

    .btn-warning {
        background: var(--warning);
        color: #1f2937;
    }

    .btn-info {
        background: var(--info);
    }

    .purge-results {
        background: var(--bg-primary);
        border-radius: 0.75rem;
        border: 1px solid var(--border-color);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .purge-results h3 {
        margin: 0 0 1rem 0;
        color: var(--text-primary);
        font-size: 1.125rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .purge-result {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
        font-size: 0.9375rem;
    }

    .purge-result:last-child {
        margin-bottom: 0;
    }

    .purge-result.text-success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .purge-result.text-danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--error);
    }

    .purge-result i {
        font-size: 1.125rem;
    }

    .text-muted {
        color: var(--text-muted);
        text-align: center;
        padding: 1rem;
    }

    .info-box {
        background: var(--bg-tertiary);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-top: 1.5rem;
    }

    .info-box h4 {
        margin: 0 0 1rem 0;
        color: var(--text-primary);
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .info-box ul {
        margin: 0;
        padding-left: 1.5rem;
    }

    .info-box li {
        margin-bottom: 0.75rem;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .info-box li:last-child {
        margin-bottom: 0;
    }

    .info-box li strong {
        color: var(--text-primary);
    }

    .breadcrumb {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.875rem;
        color: var(--text-muted);
    }

    .breadcrumb a {
        color: var(--primary-color);
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }
</style>

<div class="breadcrumb">
    <a href="/admin">{{#str}}administration,core{{/str}}</a>
    <span>/</span>
    <span>{{#str}}cache_purge,admin{{/str}}</span>
</div>

<div class="page-header">
    <h1><i class="fas fa-database"></i> {{#str}}cache_purge,admin{{/str}}</h1>
</div>

{{#success}}
<div class="alert alert-success">
    <i class="fas fa-check-circle alert-icon"></i>
    <div><strong>{{#str}}cache_purge_success,admin{{/str}}:</strong> {{success}}</div>
</div>
{{/success}}

{{#haserrors}}
<div class="alert alert-danger">
    <i class="fas fa-exclamation-circle alert-icon"></i>
    <div>
        <strong>{{#str}}error_occurred,admin{{/str}}:</strong>
        <ul style="margin: 0.5rem 0 0 1.25rem; padding: 0;">
            {{#errors}}
            <li>{{.}}</li>
            {{/errors}}
        </ul>
    </div>
</div>
{{/haserrors}}

{{#has_purge_results}}
<div class="purge-results">
    <h3><i class="fas fa-clipboard-check"></i> {{#str}}cache_purge_results,admin{{/str}}</h3>

    {{#purge_results.opcache}}
    <div class="purge-result {{#success}}text-success{{/success}}{{^success}}text-danger{{/success}}">
        {{#success}}<i class="fas fa-check-circle"></i>{{/success}}
        {{^success}}<i class="fas fa-times-circle"></i>{{/success}}
        <strong>OPcache:</strong> {{message}}
    </div>
    {{/purge_results.opcache}}

    {{#purge_results.mustache}}
    <div class="purge-result {{#success}}text-success{{/success}}{{^success}}text-danger{{/success}}">
        {{#success}}<i class="fas fa-check-circle"></i>{{/success}}
        {{^success}}<i class="fas fa-times-circle"></i>{{/success}}
        <strong>{{#str}}cache_purge_mustache,admin{{/str}}:</strong> {{message}}
    </div>
    {{/purge_results.mustache}}

    {{#purge_results.i18n}}
    <div class="purge-result {{#success}}text-success{{/success}}{{^success}}text-danger{{/success}}">
        {{#success}}<i class="fas fa-check-circle"></i>{{/success}}
        {{^success}}<i class="fas fa-times-circle"></i>{{/success}}
        <strong>{{#str}}cache_purge_i18n,admin{{/str}}:</strong> {{message}}
    </div>
    {{/purge_results.i18n}}

    {{#purge_results.application}}
    <div class="purge-result {{#success}}text-success{{/success}}{{^success}}text-danger{{/success}}">
        {{#success}}<i class="fas fa-check-circle"></i>{{/success}}
        {{^success}}<i class="fas fa-times-circle"></i>{{/success}}
        <strong>{{#str}}cache_purge_app,admin{{/str}}:</strong> {{message}}
    </div>
    {{/purge_results.application}}

    {{#purge_results.rbac}}
    <div class="purge-result {{#success}}text-success{{/success}}{{^success}}text-danger{{/success}}">
        {{#success}}<i class="fas fa-check-circle"></i>{{/success}}
        {{^success}}<i class="fas fa-times-circle"></i>{{/success}}
        <strong>{{#str}}cache_purge_rbac,admin{{/str}}:</strong> {{message}}
    </div>
    {{/purge_results.rbac}}
</div>
{{/has_purge_results}}

<div class="cache-grid">
    <!-- OPcache Status -->
    <div class="cache-card">
        <div class="cache-card-header">
            <i class="fas fa-microchip"></i> OPcache {{#str}}cache_status,admin{{/str}}
        </div>
        <div class="cache-card-body">
            {{#opcache_enabled}}
            <table class="stats-table">
                <tr>
                    <th>{{#str}}cache_status,admin{{/str}}</th>
                    <td><span class="badge badge-success"><i class="fas fa-check"></i> {{#str}}cache_enabled,admin{{/str}}</span></td>
                </tr>
                <tr>
                    <th>{{#str}}cache_memory_used,admin{{/str}}</th>
                    <td>{{opcache_memory_used}}</td>
                </tr>
                <tr>
                    <th>{{#str}}cache_memory_free,admin{{/str}}</th>
                    <td>{{opcache_memory_free}}</td>
                </tr>
                <tr>
                    <th>{{#str}}cache_memory_wasted,admin{{/str}}</th>
                    <td>{{opcache_memory_wasted}}</td>
                </tr>
                <tr>
                    <th>{{#str}}cache_scripts,admin{{/str}}</th>
                    <td>{{opcache_scripts}}</td>
                </tr>
                <tr>
                    <th>{{#str}}cache_hits,admin{{/str}}</th>
                    <td>{{opcache_hits}}</td>
                </tr>
                <tr>
                    <th>{{#str}}cache_misses,admin{{/str}}</th>
                    <td>{{opcache_misses}}</td>
                </tr>
                {{#opcache_hit_rate}}
                <tr>
                    <th>{{#str}}cache_hit_rate,admin{{/str}}</th>
                    <td><strong style="color: var(--success);">{{opcache_hit_rate}}</strong></td>
                </tr>
                {{/opcache_hit_rate}}
            </table>
            {{/opcache_enabled}}
            {{^opcache_enabled}}
            <p class="text-muted"><i class="fas fa-times-circle"></i> {{#str}}cache_opcache_disabled,admin{{/str}}</p>
            {{/opcache_enabled}}
        </div>
    </div>

    <!-- Mustache Cache Status -->
    <div class="cache-card">
        <div class="cache-card-header">
            <i class="fas fa-file-code"></i> {{#str}}cache_purge_mustache,admin{{/str}} {{#str}}cache_status,admin{{/str}}
        </div>
        <div class="cache-card-body">
            {{#mustache_enabled}}
            <table class="stats-table">
                <tr>
                    <th>{{#str}}cache_status,admin{{/str}}</th>
                    <td><span class="badge badge-success"><i class="fas fa-check"></i> {{#str}}cache_enabled,admin{{/str}}</span></td>
                </tr>
                <tr>
                    <th>{{#str}}cache_templates,admin{{/str}}</th>
                    <td>{{mustache_templates}}</td>
                </tr>
                <tr>
                    <th>{{#str}}cache_size,admin{{/str}}</th>
                    <td>{{mustache_cache_size}}</td>
                </tr>
            </table>
            {{/mustache_enabled}}
            {{^mustache_enabled}}
            <p class="text-muted"><i class="fas fa-times-circle"></i> {{#str}}cache_mustache_disabled,admin{{/str}}</p>
            {{/mustache_enabled}}
        </div>
    </div>

    <!-- Purge Actions -->
    <div class="cache-card">
        <div class="cache-card-header">
            <i class="fas fa-trash-alt"></i> {{#str}}cache_purge,admin{{/str}}
        </div>
        <div class="cache-card-body">
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
                {{#str}}cache_purge_help,admin{{/str}}
            </p>

            <form method="POST" action="" style="margin-bottom: 0.75rem;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="purge_type" value="all">
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-trash"></i> {{#str}}cache_purge_all,admin{{/str}}
                </button>
            </form>

            {{#opcache_enabled}}
            <form method="POST" action="" style="margin-bottom: 0.75rem;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="purge_type" value="opcache">
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-microchip"></i> {{#str}}cache_purge_opcache,admin{{/str}}
                </button>
            </form>
            {{/opcache_enabled}}

            {{#mustache_enabled}}
            <form method="POST" action="" style="margin-bottom: 0.75rem;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="purge_type" value="mustache">
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-file-code"></i> {{#str}}cache_purge_mustache,admin{{/str}}
                </button>
            </form>
            {{/mustache_enabled}}

            <form method="POST" action="" style="margin-bottom: 0.75rem;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="purge_type" value="i18n">
                <button type="submit" class="btn btn-info">
                    <i class="fas fa-language"></i> {{#str}}cache_purge_i18n,admin{{/str}}
                </button>
            </form>

            <form method="POST" action="" style="margin-bottom: 0.75rem;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="purge_type" value="application">
                <button type="submit" class="btn btn-info">
                    <i class="fas fa-cog"></i> {{#str}}cache_purge_app,admin{{/str}}
                </button>
            </form>

            <form method="POST" action="">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="purge_type" value="rbac">
                <button type="submit" class="btn btn-info">
                    <i class="fas fa-shield-alt"></i> {{#str}}cache_purge_rbac,admin{{/str}}
                </button>
            </form>
        </div>
    </div>
</div>

<div class="info-box">
    <h4><i class="fas fa-info-circle"></i> {{#str}}cache_about,admin{{/str}}</h4>
    <ul>
        <li><strong>OPcache:</strong> {{#str}}cache_opcache_help,admin{{/str}}</li>
        <li><strong>{{#str}}cache_purge_mustache,admin{{/str}}:</strong> {{#str}}cache_mustache_help,admin{{/str}}</li>
        <li><strong>{{#str}}cache_purge_i18n,admin{{/str}}:</strong> {{#str}}cache_i18n_help,admin{{/str}}</li>
        <li><strong>{{#str}}cache_purge_app,admin{{/str}}:</strong> {{#str}}cache_app_help,admin{{/str}}</li>
        <li><strong>{{#str}}cache_purge_rbac,admin{{/str}}:</strong> {{#str}}cache_rbac_help,admin{{/str}}</li>
    </ul>
</div>

{{> core/footer}}
