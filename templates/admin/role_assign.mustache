{{!
    Role Assignment Template

    Context:
    * user_view - Boolean for user view mode
    * role_view - Boolean for role view mode
    * user_id - User ID
    * user_username - Username
    * user_fullname - User full name
    * user_email - User email
    * role_id - Role ID
    * role_name - Role name
    * role_shortname - Role shortname
    * role_description - Role description
    * roles - Array of roles (for user view)
    * users - Array of users (for role view)
    * has_users - Boolean for users
    * has_no_users - Boolean for no users
    * success - Success message
    * has_errors - Boolean for errors
    * errors - Array of errors
    * sesskey - Session key
}}
{{> core/header}}

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-header h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 0;
    }

    .info-card {
        background: var(--bg-tertiary);
        border-radius: 0.5rem;
        padding: 1.25rem;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--primary-color);
    }

    .info-card p {
        margin: 0.25rem 0;
        color: var(--text-secondary);
    }

    .info-card strong {
        color: var(--text-primary);
    }

    .content-card {
        background: var(--bg-primary);
        border-radius: 0.75rem;
        padding: 2rem;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
    }

    .content-card h2 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 1.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .alert {
        padding: 1rem 1.25rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .alert-success {
        background: rgba(16, 185, 129, 0.1);
        border-left: 4px solid var(--success);
        color: var(--success);
    }

    .alert-danger {
        background: rgba(239, 68, 68, 0.1);
        border-left: 4px solid var(--error);
        color: var(--error);
    }

    .alert-icon {
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .roles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.25rem;
    }

    .role-card {
        background: var(--bg-primary);
        border: 2px solid var(--border-color);
        border-radius: 0.75rem;
        padding: 1.25rem;
        transition: all var(--transition-fast);
    }

    .role-card:hover {
        border-color: var(--primary-light);
        box-shadow: var(--shadow-sm);
    }

    .role-card.assigned {
        background: rgba(16, 185, 129, 0.1);
        border-color: var(--success);
    }

    .role-card h3 {
        margin: 0 0 0.5rem 0;
        color: var(--primary-color);
        font-size: 1.125rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .role-card.assigned h3 {
        color: var(--success);
    }

    .role-card p {
        margin: 0 0 1rem 0;
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
        color: white;
        text-decoration: none;
        border-radius: 0.5rem;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all var(--transition-fast);
    }

    .btn:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.8125rem;
    }

    .btn-success {
        background: var(--success);
    }

    .btn-danger {
        background: var(--error);
    }

    .btn-secondary {
        background: var(--text-secondary);
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--bg-primary);
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
    }

    .data-table thead {
        background: var(--bg-tertiary);
    }

    .data-table th,
    .data-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }

    .data-table th {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .data-table tbody tr:hover {
        background: var(--bg-secondary);
    }

    .data-table tbody tr:last-child td {
        border-bottom: none;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--text-muted);
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .empty-state h3 {
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .breadcrumb {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.875rem;
        color: var(--text-muted);
    }

    .breadcrumb a {
        color: var(--primary-color);
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }
</style>

<div class="breadcrumb">
    <a href="/admin">{{#str}}administration,core{{/str}}</a>
    <span>/</span>
    {{#user_view}}
    <a href="/admin/user/">{{#str}}users,core{{/str}}</a>
    {{/user_view}}
    {{#role_view}}
    <a href="/admin/roles/">{{#str}}roles,core{{/str}}</a>
    {{/role_view}}
    <span>/</span>
    <span>{{#str}}assignroles,core{{/str}}</span>
</div>

{{#user_view}}
<!-- Vista por usuario -->
<div class="page-header">
    <h1><i class="fas fa-user-shield"></i> {{#str}}assignroles,core{{/str}}</h1>
</div>

<div class="info-card">
    <p><strong><i class="fas fa-user"></i> {{#str}}user,core{{/str}}:</strong> {{user_username}}</p>
    <p><strong><i class="fas fa-id-card"></i> {{#str}}name,core{{/str}}:</strong> {{user_fullname}}</p>
    <p><strong><i class="fas fa-envelope"></i> {{#str}}email,core{{/str}}:</strong> {{user_email}}</p>
</div>

<div class="content-card">
    {{#success}}
    <div class="alert alert-success">
        <i class="fas fa-check-circle alert-icon"></i>
        <div>{{{success}}}</div>
    </div>
    {{/success}}

    {{#has_errors}}
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle alert-icon"></i>
        <div>
            <ul style="margin: 0; padding-left: 1.25rem;">
                {{#errors}}
                <li>{{{.}}}</li>
                {{/errors}}
            </ul>
        </div>
    </div>
    {{/has_errors}}

    <h2><i class="fas fa-shield-alt"></i> {{#str}}availableroles,core{{/str}}</h2>

    <div class="roles-grid">
        {{#roles}}
        <div class="role-card {{#is_assigned}}assigned{{/is_assigned}}">
            <h3>
                {{#is_assigned}}<i class="fas fa-check-circle"></i>{{/is_assigned}}
                {{^is_assigned}}<i class="fas fa-shield-alt"></i>{{/is_assigned}}
                {{role_name}}
            </h3>
            <p>{{role_description}}</p>

            {{#is_assigned}}
            <form method="POST" style="display: inline;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="assignroleid" value="{{role_id}}">
                <input type="hidden" name="assignaction" value="unassign">
                <button type="submit" class="btn btn-sm btn-danger">
                    <i class="fas fa-minus-circle"></i> {{#str}}removerole,core{{/str}}
                </button>
            </form>
            {{/is_assigned}}
            {{^is_assigned}}
            <form method="POST" style="display: inline;">
                <input type="hidden" name="sesskey" value="{{sesskey}}">
                <input type="hidden" name="assignroleid" value="{{role_id}}">
                <input type="hidden" name="assignaction" value="assign">
                <button type="submit" class="btn btn-sm btn-success">
                    <i class="fas fa-plus-circle"></i> {{#str}}assignrole,core{{/str}}
                </button>
            </form>
            {{/is_assigned}}
        </div>
        {{/roles}}
    </div>
</div>
{{/user_view}}

{{#role_view}}
<!-- Vista por rol -->
<div class="page-header">
    <h1><i class="fas fa-users"></i> {{#str}}userswithrol,core{{/str}}</h1>
</div>

<div class="info-card">
    <p><strong><i class="fas fa-shield-alt"></i> {{#str}}role,core{{/str}}:</strong> {{role_name}}</p>
    <p><strong><i class="fas fa-tag"></i> {{#str}}roleshortname,core{{/str}}:</strong> {{role_shortname}}</p>
    {{#role_description}}
    <p><strong><i class="fas fa-info-circle"></i> {{#str}}description,core{{/str}}:</strong> {{role_description}}</p>
    {{/role_description}}
</div>

<div class="content-card">
    {{#has_no_users}}
    <div class="empty-state">
        <i class="fas fa-users-slash"></i>
        <h3>{{#str}}nouserswithcriteria,core{{/str}}</h3>
        <p>{{#str}}nouserswithrole,core{{/str}}</p>
    </div>
    {{/has_no_users}}

    {{#has_users}}
    <table class="data-table">
        <thead>
            <tr>
                <th>{{#str}}username,core{{/str}}</th>
                <th>{{#str}}name,core{{/str}}</th>
                <th>{{#str}}email,core{{/str}}</th>
                <th>{{#str}}actions,core{{/str}}</th>
            </tr>
        </thead>
        <tbody>
            {{#users}}
            <tr>
                <td><strong>{{user_username}}</strong></td>
                <td>{{user_fullname}}</td>
                <td>{{user_email}}</td>
                <td>
                    <a href="/admin/user/edit?id={{user_id}}" class="btn btn-sm btn-secondary">
                        <i class="fas fa-eye"></i> {{#str}}seeuser,core{{/str}}
                    </a>
                </td>
            </tr>
            {{/users}}
        </tbody>
    </table>
    {{/has_users}}
</div>
{{/role_view}}

{{> core/footer}}
